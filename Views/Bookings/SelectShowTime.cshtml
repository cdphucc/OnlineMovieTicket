@model IEnumerable<OnlineMovieTicket.Models.ShowTime>
@{
    int cinemaId = ViewBag.CinemaId;
    int movieId = ViewBag.MovieId;
    var availableDates = ViewBag.AvailableDates as List<DateTime>;
    DateTime selectedDate = ViewBag.SelectedDate;
}
<h2>Chọn suất chiếu</h2>
<div>
    @foreach (var d in availableDates)
    {
        <a href="@Url.Action("SelectShowTime", new { cinemaId, movieId, date = d.ToString("yyyy-MM-dd") })"
           style="margin-right:16px;@(d == selectedDate ? "font-weight:bold;" : "")">@d.ToString("dd/MM/yyyy")</a>
    }
</div>
<ul>
    @foreach (var show in Model)
    {
        // Số ghế trống = tổng ghế phòng - số BookingDetail của suất này có Status = "Booked"
        var totalSeats = show.Room.Seats.Count();
        var bookedSeats = show.BookingDetails?.Count(bd => bd.Status == "Booked") ?? 0;
        var seatsLeft = totalSeats - bookedSeats;
        <li>
            <b>@show.StartTime.ToString("HH:mm") - Phòng: @show.Room.Name</b> |
            <span>@seatsLeft ghế trống</span>
            @if (seatsLeft > 0 && show.Status == "Active")
            {
                <a href="@Url.Action("SelectSeat", new { showTimeId = show.Id })">Đặt vé</a>
            }
            else
            {
                <span style="color:red;">Hết vé</span>
            }
        </li>
    }
</ul>