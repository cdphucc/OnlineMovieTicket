@model List<IGrouping<OnlineMovieTicket.Models.Movie, OnlineMovieTicket.Models.ShowTime>>
@using System.Globalization
@{
    var availableDates = ViewBag.AvailableDates as List<DateTime>;
    DateTime selectedDate = ViewBag.SelectedDate;
    int cinemaId = ViewBag.CinemaId;
}

<!-- Thanh chọn ngày -->
<div class="date-bar">
    @foreach (var d in availableDates)
    {
        <a href="@Url.Action("Index", new { cinemaId = cinemaId, date = d.ToString("yyyy-MM-dd") })"
           class="date-item @(d.Date == selectedDate.Date ? "active" : "")">
            <span>@d.ToString("dd/MM")</span>
            <span>@(" - " + CultureInfo.GetCultureInfo("vi-VN").DateTimeFormat.GetAbbreviatedDayName(d.DayOfWeek).ToUpper())</span>
        </a>
    }
</div>

@foreach (var movieGroup in Model)
{
    var movie = movieGroup.Key;
    <div class="movie-block">
        <div class="movie-poster">
            <img src="@movie.ImageUrl" alt="@movie.Title" />
        </div>
        <div class="movie-info">
            <h3>@movie.Title</h3>
            <div class="movie-meta">
                <span>@movie.Genre</span>
                <span>• @movie.Duration phút</span>
            </div>
            @foreach (var showByFormat in movieGroup.GroupBy(s => s.Format))
            {
                <div class="show-format">@showByFormat.Key</div>
                <div class="showtimes-row">
                    @foreach (var show in showByFormat)
                    {
                        var seatsLeft = show.TotalSeats - show.BookedSeats;
                        if (seatsLeft == 0)
                        {
                            <a href="@Url.Action("Book", "Tickets", new { showTimeId = show.Id })"
                               class="showtime-btn disabled"
                               tabindex="-1" aria-disabled="true">
                                <span>@show.StartTime.ToString("HH:mm")</span>
                                <span class="seats">0 ghế trống</span>
                            </a>
                        }
                        else
                        {
                            <a href="@Url.Action("Book", "Tickets", new { showTimeId = show.Id })"
                               class="showtime-btn">
                                <span>@show.StartTime.ToString("HH:mm")</span>
                                <span class="seats">@seatsLeft ghế trống</span>
                            </a>
                        }
                    }
                </div>
            }
        </div>
    </div>
}